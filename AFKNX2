-- [[ No lag NX2 $ - RESTART FIX ]] --
local lp = game.Players.LocalPlayer
local cg = game:GetService("CoreGui")
local stats = game:GetService("Stats")
local startTime = os.time()

-- [نظام التنظيف القوي] يمسح أي نسخة سابقة عشان ما يعلق
for _, old in pairs(cg:GetChildren()) do
    if old.Name == "NX2_FINAL_SYSTEM" or old.Name == "NX2_INTRO" then
        old:Destroy()
    end
end

-- [1] واجهة الدخول (3 ثواني)
local function runIntro(callback)
    local introGui = Instance.new("ScreenGui", cg)
    introGui.Name = "NX2_INTRO"
    introGui.IgnoreGuiInset = true
    
    local bg = Instance.new("Frame", introGui)
    bg.Size = UDim2.new(1, 0, 1, 0)
    bg.BackgroundColor3 = Color3.new(0, 0, 0)
    bg.BackgroundTransparency = 0.7
    
    local t = Instance.new("TextLabel", introGui)
    t.Size = UDim2.new(1, 0, 1, 0)
    t.BackgroundTransparency = 1
    t.TextColor3 = Color3.new(1, 1, 1)
    t.Font = Enum.Font.SourceSansBold
    t.TextSize = 100
    t.Text = ""
    
    task.spawn(function()
        local fullText = "No lag NX2 $"
        for i = 1, #fullText do
            t.Text = string.sub(fullText, 1, i)
            task.wait(0.05)
        end
        task.wait(3)
        introGui:Destroy()
        callback()
    end)
end

-- [2] واجهة الأوامر
function createMainUI()
    local sg = Instance.new("ScreenGui", cg)
    sg.Name = "NX2_FINAL_SYSTEM"
    sg.ResetOnSpawn = false -- يخلي السكربت ما يختفي لو مت
    
    local main = Instance.new("Frame", sg)
    main.Size = UDim2.new(0, 200, 0, 220)
    main.Position = UDim2.new(0.05, 0, 0.3, 0)
    main.BackgroundColor3 = Color3.new(0, 0, 0)
    main.BackgroundTransparency = 0.3
    main.BorderSizePixel = 0
    main.Active = true
    main.Draggable = true
    Instance.new("UICorner", main)

    local title = Instance.new("TextLabel", main)
    title.Size = UDim2.new(1, 0, 0.15, 0)
    title.BackgroundTransparency = 1
    title.TextColor3 = Color3.new(1, 1, 1)
    title.Font = Enum.Font.SourceSansBold
    title.TextSize = 18
    title.Text = "No lag NX2 $"

    local pingL = Instance.new("TextLabel", main)
    pingL.Size = UDim2.new(1, 0, 0.15, 0)
    pingL.Position = UDim2.new(0, 0, 0.15, 0)
    pingL.BackgroundTransparency = 1
    pingL.TextColor3 = Color3.fromRGB(0, 255, 120)
    pingL.Font = Enum.Font.Code
    pingL.TextSize = 15
    
    task.spawn(function()
        while sg.Parent do -- يتأكد إن الواجهة موجودة قبل التحديث
            local p = stats.Network.ServerStatsItem["Data Ping"]:GetValue()
            pingL.Text = "Ping: " .. math.floor(p) .. " ms"
            task.wait(1)
        end
    end)

    local function createBtn(txt, pos, func)
        local b = Instance.new("TextButton", main)
        b.Size = UDim2.new(0.85, 0, 0.14, 0)
        b.Position = pos
        b.BackgroundColor3 = Color3.new(1, 1, 1)
        b.BackgroundTransparency = 0.1
        b.TextColor3 = Color3.new(0, 0, 0)
        b.Font = Enum.Font.SourceSansBold
        b.TextSize = 14
        b.Text = txt
        Instance.new("UICorner", b)
        b.MouseButton1Click:Connect(function() func(b) end)
        return b
    end

    createBtn("No Lag / Booster", UDim2.new(0.075, 0, 0.32, 0), function(btn)
        task.spawn(function()
            settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
            for _, v in pairs(game:GetDescendants()) do
                if v:IsA("BasePart") then v.Material = Enum.Material.SmoothPlastic v.Reflectance = 0 end
                if v:IsA("Decal") or v:IsA("Texture") then v.Transparency = 1 end
                if v:IsA("ParticleEmitter") or v:IsA("Trail") then v.Enabled = false end
            end
        end)
        btn.Text = "Applied ✅"
        task.wait(1)
        btn.Text = "No Lag / Booster"
    end)

    local afkOn = false
    createBtn("AFK Mode", UDim2.new(0.075, 0, 0.48, 0), function(btn)
        afkOn = not afkOn
        if afkOn then
            btn.Text = "Stop AFK ✅"
            btn.TextColor3 = Color3.fromRGB(255, 0, 0)
            _G.AFK_CONN = lp.Idled:Connect(function()
                game:GetService("GuiService"):SetInspectMenuEnabled(false)
            end)
        else
            btn.Text = "AFK Mode"
            btn.TextColor3 = Color3.new(0, 0, 0)
            if _G.AFK_CONN then _G.AFK_CONN:Disconnect() end
        end
    end)

    createBtn("Discord Server", UDim2.new(0.075, 0, 0.64, 0), function(btn)
        setclipboard("https://discord.gg/XKvkedtd7")
        btn.Text = "Copied ✅"
        task.wait(1)
        btn.Text = "Discord Server"
    end)

    local timeL = Instance.new("TextLabel", main)
    timeL.Size = UDim2.new(1, 0, 0.15, 0)
    timeL.Position = UDim2.new(0, 0, 0.82, 0)
    timeL.BackgroundTransparency = 1
    timeL.TextColor3 = Color3.new(0.8, 0.8, 0.8)
    timeL.Font = Enum.Font.SourceSans
    timeL.TextSize = 13
    task.spawn(function()
        while sg.Parent do
            local s = os.time() - startTime
            timeL.Text = string.format("Session: %02d:%02d:%02d", math.floor(s/3600), math.floor(s/60)%60, s%60)
            task.wait(1)
        end
    end)
end

-- تشغيل السكربت
runIntro(createMainUI)